<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>タグ管理 (ToDo ID: {{ todo.id }})</title>
    <link href="/static/css/style.css" rel="stylesheet">
</head>
<body>
    <h1>タグ管理</h1>
    <h2>対象ToDo: {{ todo.content }} (ID: {{ todo.id }})</h2>

    <hr>
    
    <h3>現在のタグ</h3>
    <ul>
        {% for tag in todo.tags %}
            <li>
                {{ tag.description }} (ID: {{ tag.id }})
            </li>
        {% else %}
            <li>現在タグはありません</li>
        {% endfor %}
    </ul>

    <hr>

    <h3>既存のタグを追加</h3>
    <form action="/todo/{{ todo.id }}/tags/add" method="post">
        <label for="tag_id">追加するタグ:</label>
        <select name="tag_id" id="tag_id" required>
            <option value="">-- タグを選択 --</option>
            {% for tag in all_tags %}
                {% set tag_already_added = false %}
                {% for current_tag in todo.tags %}
                    {% if current_tag.id == tag.id %}
                        {% set tag_already_added = true %}
                    {% endif %}
                {% endfor %}
                {% if not tag_already_added %}
                    <option value="{{ tag.id }}">{{ tag.description }}</option>
                {% endif %}
            {% endfor %}
        </select>
        <button type="submit">タグを追加</button>
    </form>

    <hr>
    
    <h3>新しいタグを作成して追加</h3>
    <form action="/tag/create/from-page" method="post">
        <input type="hidden" name="todo_id" value="{{ todo.id }}">
        
        <label for="new-tag-desc">新しいタグ名:</label>
        <input type="text" id="new-tag-desc" name="description" required>
        <button type="submit">新しいタグを作成</button>
    </form>

    <hr>
    
    <a href="/todo/{{ todo.id }}">詳細に戻る</a> |
    <a href="/">一覧に戻る</a>
</body>
</html>